{% extends  'template.html' %}
{% block body %}
<div class="root-container">
    <div class="list-container">
        <div class="container" style="font-size: 2.5vh;">
            <span>
                <b>Profit and Loss</b><br>
                <span style="font-size: 4vh;">Net Profit: &#8377;<label id="expense-label">80000</label></span>
            </span>
            <div>
                <span style="font-size: 4vh;">+ &#8377;<label id="profit-label"></label></span><br>
                <div id="income" class="bar-graph-container">
                    <span id="slice-1" title="100000" class="bar-graph-slice tooltip" data-text="&#8377; 100000">&#8377; 100000</span>
                    <span></span>
                </div>
                <span style="font-size: 4vh;">- &#8377;<label id="loss-label"></label></span>
                <div id="expense" class="bar-graph-container">
                    <span id="slice-2" title="20000" class="bar-graph-slice tooltip" data-text="&#8377; 20000">&#8377; 20000</span>
                    <span></span>
                </div>
            </div> 
        </div>
        <div class="container" style="font-size: 2.5vh;">
            <span>
                <b>Expenses</b><br>
                <span style="font-size: 4vh;">&#8377;<label id="expense-label"></label></span>
                <div id="expenses" class="bar-graph-container">
                    {% for cat, price in exp_tally.items %}
                        <span id="slice-1" class="bar-graph-slice tooltip" data-text="&#8377; {{price}}"></span>
                    {%endfor%}
                </div>
            </span>
            <div>
                <table id="category-table">
                </table>
            </div> 
        </div>
    </div>
</div>
{%endblock%}

{% block script %}
<script>

$(document).ready(function (){

    expensesGraph();
    profitAndLossGraph();

    function profitAndLossGraph() {
        var income = 100000;
        var expense = 20000;
        var barSliceWidth = ""
        var total = income + expense;

        var incomeSliceWidth = (income/total)*100;
        var expenseSliceWidth = (expense/total)*100;
        incomeBarSliceWidth = incomeSliceWidth + "% " + expenseSliceWidth + "%";
        lossBarSliceWidth = incomeSliceWidth + "% " + expenseSliceWidth + "%";

        var barGraph = $("#income");
        barGraph.css('gridTemplateColumns', incomeBarSliceWidth);

        barGraph.children().first().css({
            'borderRadius': "8px 0 0 8px",
            'backgroundColor': '#76f05b',
        });
        barGraph.children().last().css({
            'borderRadius': "0 8px 8px 0",
            'backgroundColor': 'rgba(118,240,91,0.5)'
        });

        var barGraph = $("#expense");
        barGraph.css('gridTemplateColumns', lossBarSliceWidth);

        barGraph.children().first().css({
            'borderRadius': "8px 0 0 8px",
            'backgroundColor': '#ff4040'
        });

        barGraph.children().last().css({
            'borderRadius': "0 8px 8px 0",
            'backgroundColor': 'rgba(255,64,64,0.5)',
        });
    }

    function expensesGraph() {

        var expenses = {};

        {% for cat, price in exp_tally.items %}
            expenses["{{cat}}"] = {{price}};
        {%endfor%}

        var colours = ["#5FBFF9", "#3B3B58", "#478978", "#F9DB6D", "#88B7B5"]
        var barSliceWidth = "";
        var totalExpense = 0;

        var categories = {};

        var categoryCount = 0;

        for (var category in expenses) {
            categories[category] = colours[categoryCount];
            categoryCount++;
        }

        for (var category in categories) {
            console.log(category + ":" + categories[category]);
            
            var categoryTable = $("#category-table")
            var categoryRow = $("<tr></tr>");
            var categoryBox = $("<th></th>");
            var categoryBoxColor = $("<div></div>");
            categoryBoxColor.css({
                                    "backgroundColor": categories[category],
                                    "height": "2vh",
                                    "width": "2vh",
                                    "fontSize": 0
                                });
            categoryBox.append(categoryBoxColor);
            var categoryLable = $("<td>"+ category +"</td>");

            categoryRow.append(categoryBox, categoryLable);
            categoryTable.append(categoryRow);
        }

        for (var expense in expenses) {
            totalExpense += expenses[expense];
        }

        for(var slicePercent in expenses) {
            var sliceWidth = (expenses[slicePercent]/totalExpense)*100;
            barSliceWidth += sliceWidth + "% "
        }

        var barGraph = $("#expenses");
        barGraph.css('gridTemplateColumns', barSliceWidth);

        barGraph.children().first().css('borderRadius', "8px 0 0 8px");
        barGraph.children().last().css('borderRadius', "0 8px 8px 0");

        var i = 0;

        barGraph.children().each(function (index, element) {

            $(element).css({
                'backgroundColor': colours[i]
            });

            if (i == colours.length ) {
                i = 0;
            } else {
                i++;
            }

        });
    }

});
</script>
{%endblock%}