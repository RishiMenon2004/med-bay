{%extends "template.html" %}
{%load static%}

{%block body%}
<div class="shop-container-root">
    <h3 id="shop-list-title">Items in stock</h3><br>
    <div class="shop-list-container">
        {%for item in items%}
        <div id="{{item.id}}" class="stock-item-container">
            <label class="stock-detail-label">Item: </label>
            <input class="stock-detail" id="{{item.id}}_name" type="text" value="{{item.name}}" readonly><br>
            <label class="stock-detail-label">Price: </label>
            <span class="stock-detail" tabindex="0"><span class="stock-price">&#8377;</span> <input tabindex="-1" class="stock-price" id="age" type="text" value="{{item.price}}" pattern="[0-9]+" readonly></span><br>
            <span>
                <label class="stock-detail-label">Amount:</label>
                <input class="stock-detail" id="{{item.id}}_amount" type="number" min="1" max="{{item.quantity}}" step="1" value="1">
                <label>/{{item.quantity}}</label><br>
                <input class="stock-detail" id="add-to-cart" onclick="addtocart({{item.id}})" type="button" value="Add To Cart">
                <input class="stock-detail" id="edit" type="button" value="Edit">
            </span>
        </div>
        {%endfor%}
    </div>
</div>
{%endblock%}


{%block script%}
<script>
    function addtocart(id) {
      console.log("item id: " + id);
        var name = $('#' + id + '_name').val();
        var inputAmount = $('#' + id + '_amount');
        var amount = inputAmount.val();
        var max = inputAmount.attr("max");
        
        amount = parseInt(amount);
        max = parseInt(max);
        
        if (amount > max) {
            amount = max;
            inputAmount.val(amount.toString());
        }
        
        console.log("item amount: " + amount);
        $.ajax({
            url : '/pharmacy',
            data : {
                'product_id' : id,
                'product_amount': amount
              },
            type : 'GET',
            success : function(response) {
                alert("Added " + amount + " Of " + name + " To Cart");
            },
            error : function(error) {
                alert("Error: Unable To Add To Cart");
            }
        });
    }
</script>
{%endblock%}
